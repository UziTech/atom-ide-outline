{"version":3,"file":"main.js","sources":["../src/outlineView.ts","../node_modules/atom-ide-base/src-commons-atom/ProviderRegistry.ts","../src/statuses.ts","../node_modules/lodash/isObject.js","../node_modules/lodash/_freeGlobal.js","../node_modules/lodash/_root.js","../node_modules/lodash/now.js","../node_modules/lodash/_Symbol.js","../node_modules/lodash/_getRawTag.js","../node_modules/lodash/_objectToString.js","../node_modules/lodash/_baseGetTag.js","../node_modules/lodash/isObjectLike.js","../node_modules/lodash/isSymbol.js","../node_modules/lodash/toNumber.js","../node_modules/lodash/debounce.js","../src/main.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-non-null-assertion */\nimport { TextEditor, CursorPositionChangedEvent } from \"atom\"\nimport { OutlineTree } from \"atom-ide-base\"\n\nexport class OutlineView {\n  public element: HTMLDivElement\n  constructor() {\n    this.element = document.createElement(\"div\")\n    this.element.classList.add(\"outline-view\")\n  }\n\n  destroy() {\n    this.element.remove()\n  }\n\n  getElement() {\n    return this.element\n  }\n\n  getTitle() {\n    return \"Outline\"\n  }\n\n  getIconName() {\n    return \"list-unordered\"\n  }\n\n  setOutline(outlineTree: OutlineTree[], editor: TextEditor, isLarge: boolean) {\n    const outlineViewElement = this.clearOutline()\n\n    if (isLarge) {\n      const largeFileElement = document.createElement(\"div\")\n      largeFileElement.innerHTML = `\n        <span style = \"\n          font-size: var(--editor-font-size);\n          font-family: var(--editor-font-family);\n          line-height: var(--editor-line-height);\n          color: #71844c;\n        \"\n        >Large file mode</span>\n      `\n      outlineViewElement.appendChild(largeFileElement)\n    }\n\n    const outlineRoot = document.createElement(\"ul\")\n    addOutlineEntries(\n      outlineRoot,\n      outlineTree,\n      editor,\n      /* foldInItially */ isLarge || atom.config.get(\"atom-ide-outline.foldInitially\")\n    )\n    outlineViewElement.appendChild(outlineRoot)\n  }\n\n  clearOutline() {\n    const outlineViewElement = this.getElement()\n    outlineViewElement.innerHTML = \"\"\n    return outlineViewElement\n  }\n\n  presentStatus(status: { title: string; description: string }) {\n    this.clearOutline()\n\n    const statusElement = status && generateStatusElement(status)\n\n    if (statusElement) {\n      const outlineViewElement = this.getElement()\n      outlineViewElement.appendChild(statusElement)\n    }\n  }\n}\n\nfunction generateStatusElement(status: { title: string; description: string }) {\n  const element = document.createElement(\"div\")\n  element.className = \"status\"\n\n  const { title = \"\", description = \"\" } = status\n  element.innerHTML = `<h1>${title}</h1>\n  <span>${description}</span>`\n\n  return element\n}\n\nconst PointToElementsMap: Map<number, Array<HTMLLIElement>> = new Map() // TODO Point to element\n\nlet clicked: boolean = false // used to prevent scrolling in the outline list when an entry is clicked\n\nfunction addOutlineEntries(\n  parent: HTMLUListElement,\n  entries: OutlineTree[],\n  editor: TextEditor,\n  isLarge: boolean,\n  level = 0\n) {\n  // NOTE: this function is called multiple times with each update in an editor!\n  // a few of the calls is slow ~1-100ms\n\n  // calculate indent length\n  const tabLength = editor.getTabLength()\n  const indentRatio = 16 * (typeof tabLength === \"number\" ? tabLength : 4)\n\n  // sort entries\n  // TIME 0.1ms\n  if (atom.config.get(\"atom-ide-outline.sortEntries\")) {\n    entries.sort((e1: OutlineTree, e2: OutlineTree) => {\n      const rowCompare = e1.startPosition.row - e2.startPosition.row\n      if (rowCompare === 0) {\n        // compare based on column if on the same row\n        return e1.startPosition.column - e1.startPosition.column\n      }\n      return rowCompare\n    })\n  }\n\n  for (const item of entries) {\n    const symbol = document.createElement(\"li\")\n\n    // symbol.setAttribute(\"level\", `${level}`); // store level in the element\n\n    // Hold an entry in a dedicated element to prevent hover conflicts - hover over an <li> tag would be cought by a parent <li>\n    // TIME: ~0-0.1ms\n    const labelElement = document.createElement(\"span\")\n    labelElement.innerText = (item.representativeName || item.plainText) ?? \"\"\n\n    labelElement.prepend(/* iconElement */ getIcon(item?.icon, item?.kind))\n\n    symbol.appendChild(labelElement)\n\n    // update start position => elements map\n    // TIME: 0-0.2ms\n    const elms = PointToElementsMap.get(item.startPosition.row)\n    if (elms !== undefined) {\n      elms.push(symbol)\n      PointToElementsMap.set(item.startPosition.row, elms)\n    } else {\n      PointToElementsMap.set(item.startPosition.row, [symbol])\n    }\n\n    // Cursor reposition on click\n    // TIME: 0-0.1ms\n    symbol.addEventListener(\n      \"click\",\n      () => {\n        const editorPane = atom.workspace.paneForItem(editor)\n        if (!editorPane) {\n          return\n        }\n        editorPane.activate()\n\n        editor.getCursors()[0].setBufferPosition(item.startPosition, {\n          autoscroll: true,\n        })\n\n        clicked = true\n      },\n      { passive: true }\n    )\n\n    if (/* hasChildren */ item.children == null || item.children[0] == null) {\n      // indentation\n      labelElement.style.paddingLeft = level !== 0 ? `${indentRatio * level}px` : `${foldButtonWidth}px`\n    } else {\n      // indentation\n      // compensate for the fold button\n      labelElement.style.paddingLeft = level !== 0 ? `${indentRatio * level - foldButtonWidth}px` : `0px`\n\n      // create Child elements\n      // TIME 0-0.2ms\n      const childrenList = document.createElement(\"ul\")\n      childrenList.addEventListener(\"click\", (event) => event.stopPropagation(), { passive: true })\n      symbol.appendChild(childrenList)\n\n      // fold Button\n      const foldButton = createFoldButton(childrenList, isLarge)\n      labelElement.prepend(foldButton)\n\n      // add children to outline\n      // TIME: last one of each batch is slower 0-20ms\n      addOutlineEntries(childrenList, item.children, editor, isLarge, level + 1)\n    }\n\n    // TIME: <0.1ms\n    parent.appendChild(symbol)\n  }\n}\n\nconst supportedTypes = [\n  \"array\",\n  \"boolean\",\n  \"class\",\n  \"constant\",\n  \"constructor\",\n  \"enum\",\n  \"field\",\n  \"file\",\n  \"function\",\n  \"interface\",\n  \"method\",\n  \"module\",\n  \"namespace\",\n  \"number\",\n  \"package\",\n  \"property\",\n  \"string\",\n  \"variable\",\n]\n\n// find better symbols for the rest\nconst symbolMap = new Map([\n  // [\"class\", '\\ue600'],\n  // [\"struct\", '\\ue601'],\n  // [\"macro\", '\\ue602'],\n  // [\"typedef\", '\\ue603'],\n  // [\"union\", '\\ue604'],\n  // [\"interface\", '\\ue605'],\n  // [\"enum\", '\\ue606'],\n  [\"variable\", \"\\ue607\"],\n  [\"function\", \"\\ue608\"],\n  [\"namespace\", \"\\ue609\"],\n])\n\n// find better symbols for the rest\nconst abbreviationMap = new Map([\n  [\"array\", \"arr\"],\n  [\"boolean\", \"bool\"],\n  [\"class\", \"clas\"],\n  [\"constant\", \"cons\"],\n  [\"constructor\", \"ctor\"],\n  [\"enum\", \"enum\"],\n  [\"field\", \"fild\"],\n  [\"file\", \"file\"],\n  [\"function\", \"func\"],\n  [\"interface\", \"intf\"],\n  [\"method\", \"meth\"],\n  [\"module\", \"mod\"],\n  [\"namespace\", \"ns\"],\n  [\"number\", \"num\"],\n  [\"package\", \"pkg\"],\n  [\"property\", \"prop\"],\n  [\"string\", \"str\"],\n  [\"variable\", \"var\"],\n])\n\nfunction getIconHTML(type: string | undefined) {\n  if (type) {\n    if (symbolMap.has(type)) {\n      return `<span style=\"font-family: 'symbol-icons';\">${symbolMap.get(type)}</span>`\n    }\n    if (abbreviationMap.has(type)) {\n      return `<span>${abbreviationMap.get(type)}</span>`\n    } else {\n      return `<span>${type.substring(0, 3)}</span>`\n    }\n  } else {\n    return \"<span>â€¢</span>\"\n  }\n}\n\nfunction getIcon(iconType?: string, kindType?: string) {\n  // LSP specification: https://microsoft.github.io/language-server-protocol/specifications/specification-current/#textDocument_documentSymbol\n  // atom-languageclient mapping: https://github.com/atom/atom-languageclient/blob/485bb9d706b422456640c9070eee456ef2cf09c0/lib/adapters/outline-view-adapter.ts#L270\n\n  const iconElement = document.createElement(\"span\")\n  iconElement.classList.add(\"icon\")\n\n  // if iconType given instead\n  if (kindType == undefined && iconType != undefined) {\n    kindType = iconType\n  }\n\n  let type: string | undefined\n  if (typeof kindType === \"string\" && kindType.length > 0) {\n    let kindClass: string\n    // hasKind\n    if (kindType.indexOf(\"type-\") === 0) {\n      // supplied with type-...\n      kindClass = `${kindType}`\n      type = kindType.replace(\"type-\", \"\")\n    } else if (supportedTypes.includes(kindType)) {\n      // supplied without type-\n      kindClass = `type-${kindType}`\n      type = kindType\n    } else {\n      // as is\n      kindClass = kindType\n    }\n    iconElement.classList.add(kindClass)\n  }\n\n  iconElement.innerHTML = getIconHTML(type)\n\n  return iconElement\n}\n\nconst foldButtonWidth = 20\n\nfunction createFoldButton(childrenList: HTMLUListElement, foldInitially: boolean) {\n  // TIME: ~0.1-0.5ms\n  // fold button\n  const foldButton = document.createElement(\"button\")\n\n  if (foldInitially) {\n    // collapse in large files by default\n    childrenList.hidden = true\n    foldButton.classList.add(\"fold\", \"collapsed\")\n  } else {\n    foldButton.classList.add(\"fold\", \"expanded\")\n  }\n\n  // fold listener\n  foldButton.addEventListener(\n    \"click\",\n    (event) => {\n      childrenList.hidden = !childrenList.hidden\n      if (childrenList.hidden) {\n        foldButton.classList.remove(\"expanded\")\n        foldButton.classList.add(\"collapsed\")\n      } else {\n        foldButton.classList.remove(\"collapsed\")\n        foldButton.classList.add(\"expanded\")\n      }\n      event.stopPropagation()\n    },\n    { passive: true }\n  )\n  return foldButton\n}\n\nlet focusedElms: HTMLElement[] | undefined // cache for focused elements\n\n// callback for scrolling and highlighting the element that the cursor is on\nexport function selectAtCursorLine(newBufferPosition: CursorPositionChangedEvent[\"newBufferPosition\"]) {\n  if (clicked) {\n    // do not scroll when the cursor has moved to a click on the outline entry\n    clicked = false\n    return\n  }\n\n  // TIME: ~0.2-0.3ms\n  // TODO use range of start and end instead of just the line number\n\n  // remove old cursorOn attribue\n  if (focusedElms !== undefined) {\n    for (const elm of focusedElms) {\n      elm.toggleAttribute(\"cursorOn\", false)\n    }\n  }\n\n  // add new cursorOn attribue\n  const cursorPoint = newBufferPosition.row\n  focusedElms = PointToElementsMap.get(cursorPoint)\n\n  if (focusedElms !== undefined) {\n    for (const elm of focusedElms) {\n      elm.toggleAttribute(\"cursorOn\", true)\n      elm.scrollIntoView({\n        block: \"center\", // scroll until the entry is in the center of outline\n      })\n    }\n  }\n}\n","import { Disposable, TextEditor } from \"atom\"\nimport { Provider as ProviderTypes, BusySignalProvider, FindReferencesProvider } from \"../types-packages/main.d\"\n\nexport class ProviderRegistry<Provider extends Exclude<ProviderTypes, BusySignalProvider | FindReferencesProvider>> {\n  private providers: Array<Provider>\n\n  constructor() {\n    this.providers = []\n  }\n\n  addProvider(provider: Provider): Disposable {\n    const index = this.providers.findIndex((p) => provider.priority > p.priority)\n    if (index === -1) {\n      this.providers.push(provider)\n    } else {\n      this.providers.splice(index, 0, provider)\n    }\n    return new Disposable(() => {\n      this.removeProvider(provider)\n    })\n  }\n\n  removeProvider(provider: Provider): void {\n    const index = this.providers.indexOf(provider)\n    if (index !== -1) {\n      this.providers.splice(index, 1)\n    }\n  }\n\n  // TODO deprecate since there can be N providers.\n  getProviderForEditor(editor: TextEditor): Provider | null {\n    const grammar = editor.getGrammar().scopeName\n    return this.findProvider(grammar)\n  }\n\n  // TODO create an ordering or priority aware util to prefer instead.\n  getAllProvidersForEditor(editor: TextEditor): Iterable<Provider> {\n    const grammar = editor.getGrammar().scopeName\n    return this.findAllProviders(grammar)\n  }\n\n  findProvider(grammar: string): Provider | null {\n    for (const provider of this.findAllProviders(grammar)) {\n      return provider\n    }\n    return null\n  }\n\n  /**\n   * Iterates over all providers matching the grammar, in priority order.\n   */\n  *findAllProviders(grammar: string): Iterable<Provider> {\n    for (const provider of this.providers) {\n      if (provider.grammarScopes == null || provider.grammarScopes.indexOf(grammar) !== -1) {\n        yield provider\n      }\n    }\n  }\n}\n","export const statuses = {\n  noEditor: {\n    title: \"Outline is unavailable.\",\n    description: \"Open a text editor.\",\n  },\n  noProvider: {\n    title: \"Provider is unavailable\",\n    description:\n      \"Looks like a provider for this type of file is not available. Check if a relevant IDE language package is installed and has outline support, or try adding one from Atom's package registry (e.g.: atom-ide-javascript, atom-typescript, ide-python, ide-rust, ide-css, ide-json).\",\n  },\n}\n","/**\n * Checks if `value` is the\n * [language type](http://www.ecma-international.org/ecma-262/7.0/#sec-ecmascript-language-types)\n * of `Object`. (e.g. arrays, functions, objects, regexes, `new Number(0)`, and `new String('')`)\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is an object, else `false`.\n * @example\n *\n * _.isObject({});\n * // => true\n *\n * _.isObject([1, 2, 3]);\n * // => true\n *\n * _.isObject(_.noop);\n * // => true\n *\n * _.isObject(null);\n * // => false\n */\nfunction isObject(value) {\n  var type = typeof value;\n  return value != null && (type == 'object' || type == 'function');\n}\n\nmodule.exports = isObject;\n","/** Detect free variable `global` from Node.js. */\nvar freeGlobal = typeof global == 'object' && global && global.Object === Object && global;\n\nmodule.exports = freeGlobal;\n","var freeGlobal = require('./_freeGlobal');\n\n/** Detect free variable `self`. */\nvar freeSelf = typeof self == 'object' && self && self.Object === Object && self;\n\n/** Used as a reference to the global object. */\nvar root = freeGlobal || freeSelf || Function('return this')();\n\nmodule.exports = root;\n","var root = require('./_root');\n\n/**\n * Gets the timestamp of the number of milliseconds that have elapsed since\n * the Unix epoch (1 January 1970 00:00:00 UTC).\n *\n * @static\n * @memberOf _\n * @since 2.4.0\n * @category Date\n * @returns {number} Returns the timestamp.\n * @example\n *\n * _.defer(function(stamp) {\n *   console.log(_.now() - stamp);\n * }, _.now());\n * // => Logs the number of milliseconds it took for the deferred invocation.\n */\nvar now = function() {\n  return root.Date.now();\n};\n\nmodule.exports = now;\n","var root = require('./_root');\n\n/** Built-in value references. */\nvar Symbol = root.Symbol;\n\nmodule.exports = Symbol;\n","var Symbol = require('./_Symbol');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * A specialized version of `baseGetTag` which ignores `Symbol.toStringTag` values.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the raw `toStringTag`.\n */\nfunction getRawTag(value) {\n  var isOwn = hasOwnProperty.call(value, symToStringTag),\n      tag = value[symToStringTag];\n\n  try {\n    value[symToStringTag] = undefined;\n    var unmasked = true;\n  } catch (e) {}\n\n  var result = nativeObjectToString.call(value);\n  if (unmasked) {\n    if (isOwn) {\n      value[symToStringTag] = tag;\n    } else {\n      delete value[symToStringTag];\n    }\n  }\n  return result;\n}\n\nmodule.exports = getRawTag;\n","/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/**\n * Used to resolve the\n * [`toStringTag`](http://ecma-international.org/ecma-262/7.0/#sec-object.prototype.tostring)\n * of values.\n */\nvar nativeObjectToString = objectProto.toString;\n\n/**\n * Converts `value` to a string using `Object.prototype.toString`.\n *\n * @private\n * @param {*} value The value to convert.\n * @returns {string} Returns the converted string.\n */\nfunction objectToString(value) {\n  return nativeObjectToString.call(value);\n}\n\nmodule.exports = objectToString;\n","var Symbol = require('./_Symbol'),\n    getRawTag = require('./_getRawTag'),\n    objectToString = require('./_objectToString');\n\n/** `Object#toString` result references. */\nvar nullTag = '[object Null]',\n    undefinedTag = '[object Undefined]';\n\n/** Built-in value references. */\nvar symToStringTag = Symbol ? Symbol.toStringTag : undefined;\n\n/**\n * The base implementation of `getTag` without fallbacks for buggy environments.\n *\n * @private\n * @param {*} value The value to query.\n * @returns {string} Returns the `toStringTag`.\n */\nfunction baseGetTag(value) {\n  if (value == null) {\n    return value === undefined ? undefinedTag : nullTag;\n  }\n  return (symToStringTag && symToStringTag in Object(value))\n    ? getRawTag(value)\n    : objectToString(value);\n}\n\nmodule.exports = baseGetTag;\n","/**\n * Checks if `value` is object-like. A value is object-like if it's not `null`\n * and has a `typeof` result of \"object\".\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is object-like, else `false`.\n * @example\n *\n * _.isObjectLike({});\n * // => true\n *\n * _.isObjectLike([1, 2, 3]);\n * // => true\n *\n * _.isObjectLike(_.noop);\n * // => false\n *\n * _.isObjectLike(null);\n * // => false\n */\nfunction isObjectLike(value) {\n  return value != null && typeof value == 'object';\n}\n\nmodule.exports = isObjectLike;\n","var baseGetTag = require('./_baseGetTag'),\n    isObjectLike = require('./isObjectLike');\n\n/** `Object#toString` result references. */\nvar symbolTag = '[object Symbol]';\n\n/**\n * Checks if `value` is classified as a `Symbol` primitive or object.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to check.\n * @returns {boolean} Returns `true` if `value` is a symbol, else `false`.\n * @example\n *\n * _.isSymbol(Symbol.iterator);\n * // => true\n *\n * _.isSymbol('abc');\n * // => false\n */\nfunction isSymbol(value) {\n  return typeof value == 'symbol' ||\n    (isObjectLike(value) && baseGetTag(value) == symbolTag);\n}\n\nmodule.exports = isSymbol;\n","var isObject = require('./isObject'),\n    isSymbol = require('./isSymbol');\n\n/** Used as references for various `Number` constants. */\nvar NAN = 0 / 0;\n\n/** Used to match leading and trailing whitespace. */\nvar reTrim = /^\\s+|\\s+$/g;\n\n/** Used to detect bad signed hexadecimal string values. */\nvar reIsBadHex = /^[-+]0x[0-9a-f]+$/i;\n\n/** Used to detect binary string values. */\nvar reIsBinary = /^0b[01]+$/i;\n\n/** Used to detect octal string values. */\nvar reIsOctal = /^0o[0-7]+$/i;\n\n/** Built-in method references without a dependency on `root`. */\nvar freeParseInt = parseInt;\n\n/**\n * Converts `value` to a number.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to process.\n * @returns {number} Returns the number.\n * @example\n *\n * _.toNumber(3.2);\n * // => 3.2\n *\n * _.toNumber(Number.MIN_VALUE);\n * // => 5e-324\n *\n * _.toNumber(Infinity);\n * // => Infinity\n *\n * _.toNumber('3.2');\n * // => 3.2\n */\nfunction toNumber(value) {\n  if (typeof value == 'number') {\n    return value;\n  }\n  if (isSymbol(value)) {\n    return NAN;\n  }\n  if (isObject(value)) {\n    var other = typeof value.valueOf == 'function' ? value.valueOf() : value;\n    value = isObject(other) ? (other + '') : other;\n  }\n  if (typeof value != 'string') {\n    return value === 0 ? value : +value;\n  }\n  value = value.replace(reTrim, '');\n  var isBinary = reIsBinary.test(value);\n  return (isBinary || reIsOctal.test(value))\n    ? freeParseInt(value.slice(2), isBinary ? 2 : 8)\n    : (reIsBadHex.test(value) ? NAN : +value);\n}\n\nmodule.exports = toNumber;\n","var isObject = require('./isObject'),\n    now = require('./now'),\n    toNumber = require('./toNumber');\n\n/** Error message constants. */\nvar FUNC_ERROR_TEXT = 'Expected a function';\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * Creates a debounced function that delays invoking `func` until after `wait`\n * milliseconds have elapsed since the last time the debounced function was\n * invoked. The debounced function comes with a `cancel` method to cancel\n * delayed `func` invocations and a `flush` method to immediately invoke them.\n * Provide `options` to indicate whether `func` should be invoked on the\n * leading and/or trailing edge of the `wait` timeout. The `func` is invoked\n * with the last arguments provided to the debounced function. Subsequent\n * calls to the debounced function return the result of the last `func`\n * invocation.\n *\n * **Note:** If `leading` and `trailing` options are `true`, `func` is\n * invoked on the trailing edge of the timeout only if the debounced function\n * is invoked more than once during the `wait` timeout.\n *\n * If `wait` is `0` and `leading` is `false`, `func` invocation is deferred\n * until to the next tick, similar to `setTimeout` with a timeout of `0`.\n *\n * See [David Corbacho's article](https://css-tricks.com/debouncing-throttling-explained-examples/)\n * for details over the differences between `_.debounce` and `_.throttle`.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Function\n * @param {Function} func The function to debounce.\n * @param {number} [wait=0] The number of milliseconds to delay.\n * @param {Object} [options={}] The options object.\n * @param {boolean} [options.leading=false]\n *  Specify invoking on the leading edge of the timeout.\n * @param {number} [options.maxWait]\n *  The maximum time `func` is allowed to be delayed before it's invoked.\n * @param {boolean} [options.trailing=true]\n *  Specify invoking on the trailing edge of the timeout.\n * @returns {Function} Returns the new debounced function.\n * @example\n *\n * // Avoid costly calculations while the window size is in flux.\n * jQuery(window).on('resize', _.debounce(calculateLayout, 150));\n *\n * // Invoke `sendMail` when clicked, debouncing subsequent calls.\n * jQuery(element).on('click', _.debounce(sendMail, 300, {\n *   'leading': true,\n *   'trailing': false\n * }));\n *\n * // Ensure `batchLog` is invoked once after 1 second of debounced calls.\n * var debounced = _.debounce(batchLog, 250, { 'maxWait': 1000 });\n * var source = new EventSource('/stream');\n * jQuery(source).on('message', debounced);\n *\n * // Cancel the trailing debounced invocation.\n * jQuery(window).on('popstate', debounced.cancel);\n */\nfunction debounce(func, wait, options) {\n  var lastArgs,\n      lastThis,\n      maxWait,\n      result,\n      timerId,\n      lastCallTime,\n      lastInvokeTime = 0,\n      leading = false,\n      maxing = false,\n      trailing = true;\n\n  if (typeof func != 'function') {\n    throw new TypeError(FUNC_ERROR_TEXT);\n  }\n  wait = toNumber(wait) || 0;\n  if (isObject(options)) {\n    leading = !!options.leading;\n    maxing = 'maxWait' in options;\n    maxWait = maxing ? nativeMax(toNumber(options.maxWait) || 0, wait) : maxWait;\n    trailing = 'trailing' in options ? !!options.trailing : trailing;\n  }\n\n  function invokeFunc(time) {\n    var args = lastArgs,\n        thisArg = lastThis;\n\n    lastArgs = lastThis = undefined;\n    lastInvokeTime = time;\n    result = func.apply(thisArg, args);\n    return result;\n  }\n\n  function leadingEdge(time) {\n    // Reset any `maxWait` timer.\n    lastInvokeTime = time;\n    // Start the timer for the trailing edge.\n    timerId = setTimeout(timerExpired, wait);\n    // Invoke the leading edge.\n    return leading ? invokeFunc(time) : result;\n  }\n\n  function remainingWait(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime,\n        timeWaiting = wait - timeSinceLastCall;\n\n    return maxing\n      ? nativeMin(timeWaiting, maxWait - timeSinceLastInvoke)\n      : timeWaiting;\n  }\n\n  function shouldInvoke(time) {\n    var timeSinceLastCall = time - lastCallTime,\n        timeSinceLastInvoke = time - lastInvokeTime;\n\n    // Either this is the first call, activity has stopped and we're at the\n    // trailing edge, the system time has gone backwards and we're treating\n    // it as the trailing edge, or we've hit the `maxWait` limit.\n    return (lastCallTime === undefined || (timeSinceLastCall >= wait) ||\n      (timeSinceLastCall < 0) || (maxing && timeSinceLastInvoke >= maxWait));\n  }\n\n  function timerExpired() {\n    var time = now();\n    if (shouldInvoke(time)) {\n      return trailingEdge(time);\n    }\n    // Restart the timer.\n    timerId = setTimeout(timerExpired, remainingWait(time));\n  }\n\n  function trailingEdge(time) {\n    timerId = undefined;\n\n    // Only invoke if we have `lastArgs` which means `func` has been\n    // debounced at least once.\n    if (trailing && lastArgs) {\n      return invokeFunc(time);\n    }\n    lastArgs = lastThis = undefined;\n    return result;\n  }\n\n  function cancel() {\n    if (timerId !== undefined) {\n      clearTimeout(timerId);\n    }\n    lastInvokeTime = 0;\n    lastArgs = lastCallTime = lastThis = timerId = undefined;\n  }\n\n  function flush() {\n    return timerId === undefined ? result : trailingEdge(now());\n  }\n\n  function debounced() {\n    var time = now(),\n        isInvoking = shouldInvoke(time);\n\n    lastArgs = arguments;\n    lastThis = this;\n    lastCallTime = time;\n\n    if (isInvoking) {\n      if (timerId === undefined) {\n        return leadingEdge(lastCallTime);\n      }\n      if (maxing) {\n        // Handle invocations in a tight loop.\n        clearTimeout(timerId);\n        timerId = setTimeout(timerExpired, wait);\n        return invokeFunc(lastCallTime);\n      }\n    }\n    if (timerId === undefined) {\n      timerId = setTimeout(timerExpired, wait);\n    }\n    return result;\n  }\n  debounced.cancel = cancel;\n  debounced.flush = flush;\n  return debounced;\n}\n\nmodule.exports = debounce;\n","import { CompositeDisposable, TextEditor, CursorPositionChangedEvent } from \"atom\"\nimport { OutlineView, selectAtCursorLine } from \"./outlineView\"\nimport { OutlineProvider, BusySignalRegistry, BusySignalProvider } from \"atom-ide-base\"\nimport { ProviderRegistry } from \"atom-ide-base/commons-atom/ProviderRegistry\"\n\nexport { statuses } from \"./statuses\" // for spec\nimport { statuses } from \"./statuses\"\nimport debounce from \"lodash/debounce\"\n\nlet subscriptions: CompositeDisposable\n\nlet view: OutlineView\nexport const outlineProviderRegistry = new ProviderRegistry<OutlineProvider>()\n\nlet busySignalProvider: BusySignalProvider | undefined // service might be consumed late\n\nexport function activate() {\n  subscriptions = new CompositeDisposable()\n  view = new OutlineView() // create outline pane\n  addCommands()\n  addObservers()\n  if (atom.config.get(\"atom-ide-outline.initialDisplay\")) {\n    toggleOutlineView() // initially show outline pane\n  }\n}\n\nexport function deactivate() {\n  onDidCompositeDisposable?.dispose?.()\n  subscriptions.dispose()\n  view.destroy()\n}\n\nexport function consumeSignal(registry: BusySignalRegistry) {\n  busySignalProvider = registry.create()\n  subscriptions.add(busySignalProvider)\n}\n\nexport async function consumeOutlineProvider(provider: OutlineProvider) {\n  subscriptions.add(/*  providerRegistryEntry */ outlineProviderRegistry.addProvider(provider))\n\n  // Generate (try) an outline after obtaining a provider\n  await getOutline()\n}\n\nfunction addCommands() {\n  subscriptions.add(\n    /* outlineToggle */ atom.commands.add(\"atom-workspace\", \"outline:toggle\", toggleOutlineView)\n  )\n}\n\nconst longLineLength = atom.config.get(\"linter-ui-default.longLineLength\") || 4000\nconst largeFileLineCount = atom.config.get(\"linter-ui-default.largeFileLineCount\") / 6 || 3000 // minimum number of lines to trigger large file optimizations\nfunction lineCountIfLarge(editor: TextEditor) {\n  // @ts-ignore\n  if (editor.largeFileMode) {\n    return 20000\n  }\n  const lineCount = editor.getLineCount()\n  if (lineCount >= largeFileLineCount) {\n    return lineCount\n  } else {\n    const buffer = editor.getBuffer()\n    for (let i = 0, len = lineCount; i < len; i++) {\n      if (buffer.lineLengthForRow(i) > longLineLength) {\n        return longLineLength\n      }\n    }\n    return 0 // small file\n  }\n}\n\n// disposables returned inside the oberservers\nlet onDidCompositeDisposable: CompositeDisposable | null\n\nfunction addObservers() {\n  onDidCompositeDisposable = new CompositeDisposable()\n  const activeTextEditorObserver = atom.workspace.observeActiveTextEditor(async (editor) => {\n    if (editor === undefined) {\n      return\n    }\n    // dispose the old subscriptions\n    onDidCompositeDisposable?.dispose?.()\n\n    await getOutline(editor) // initial outline\n\n    const lineCount = lineCountIfLarge(editor as TextEditor)\n\n    // How long to wait for the new changes before updating the outline.\n    // A high number will increase the responsiveness of the text editor in large files.\n    const updateDebounceTime = Math.max(lineCount / 5, 300) // 1/5 of the line count\n\n    // skip following cursor in large files\n    if (/* !isLarge */ lineCount === 0) {\n      // following cursor disposable\n      const debouncedSelectAtCursorLine = debounce(selectAtCursorLine, updateDebounceTime)\n\n      onDidCompositeDisposable!.add(\n        // update outline if cursor changes position\n        editor.onDidChangeCursorPosition((cursorPositionChangedEvent: CursorPositionChangedEvent) => {\n          debouncedSelectAtCursorLine(cursorPositionChangedEvent.newBufferPosition)\n        })\n      )\n    }\n\n    const doubouncedGetOutline = debounce(getOutline as (editor: TextEditor) => Promise<void>, updateDebounceTime)\n\n    onDidCompositeDisposable!.add(\n      // update the outline if editor stops changing\n      editor.onDidStopChanging(async () => {\n        await doubouncedGetOutline(editor)\n      }),\n\n      // clean up if the editor editor is closed\n      editor.onDidDestroy(() => {\n        setStatus(\"noEditor\")\n      })\n    )\n  })\n  subscriptions.add(activeTextEditorObserver)\n}\n\nexport function toggleOutlineView() {\n  const outlinePane = atom.workspace.paneForItem(view)\n  if (outlinePane) {\n    outlinePane.destroyItem(view)\n    return\n  }\n\n  const rightDock = atom.workspace.getRightDock()\n  const [pane] = rightDock.getPanes()\n\n  pane.addItem(view)\n  pane.activateItem(view)\n\n  rightDock.show()\n}\n\nexport async function getOutline(editor = atom.workspace.getActiveTextEditor()) {\n  // editor\n  if (editor === undefined) {\n    return setStatus(\"noEditor\")\n  }\n\n  // provider\n  const provider = outlineProviderRegistry.getProviderForEditor(editor)\n\n  if (!provider) {\n    return setStatus(\"noProvider\")\n  }\n  // @ts-ignore\n  const target = editor.getFileName()\n\n  const busySignalID = `Outline: ${target}`\n  busySignalProvider?.add(busySignalID)\n\n  const outline = await provider.getOutline(editor)\n  view.setOutline(outline?.outlineTrees ?? [], editor, Boolean(lineCountIfLarge(editor as TextEditor)))\n\n  busySignalProvider?.remove(busySignalID)\n}\n\nexport function setStatus(id: \"noEditor\" | \"noProvider\") {\n  view.presentStatus(statuses[id])\n}\n\nexport { default as config } from \"./config.json\"\n"],"names":["OutlineView","[object Object]","this","element","document","createElement","classList","add","remove","outlineTree","editor","isLarge","outlineViewElement","clearOutline","largeFileElement","innerHTML","appendChild","outlineRoot","addOutlineEntries","atom","config","get","getElement","status","statusElement","className","title","description","generateStatusElement","PointToElementsMap","Map","clicked","parent","entries","level","tabLength","getTabLength","indentRatio","sort","e1","e2","rowCompare","startPosition","row","column","item","symbol","labelElement","innerText","representativeName","plainText","prepend","getIcon","icon","kind","elms","undefined","push","set","addEventListener","editorPane","workspace","paneForItem","activate","getCursors","setBufferPosition","autoscroll","passive","children","style","paddingLeft","foldButtonWidth","childrenList","event","stopPropagation","foldButton","createFoldButton","supportedTypes","symbolMap","abbreviationMap","iconType","kindType","iconElement","type","length","kindClass","indexOf","replace","includes","has","substring","getIconHTML","foldInitially","hidden","focusedElms","selectAtCursorLine","newBufferPosition","elm","toggleAttribute","cursorPoint","scrollIntoView","block","exports","providers","provider","index","findIndex","p","priority","splice","atom_1","removeProvider","grammar","getGrammar","scopeName","findProvider","findAllProviders","grammarScopes","statuses","noEditor","noProvider","value","global","Object","freeSelf","self","freeGlobal","Function","root","Date","now","Symbol","objectProto","prototype","hasOwnProperty","nativeObjectToString","toString","symToStringTag","toStringTag","isOwn","call","tag","unmasked","e","result","getRawTag","objectToString","isObjectLike","baseGetTag","reTrim","reIsBadHex","reIsBinary","reIsOctal","freeParseInt","parseInt","isSymbol","isObject","other","valueOf","isBinary","test","slice","nativeMax","Math","max","nativeMin","min","func","wait","options","lastArgs","lastThis","maxWait","timerId","lastCallTime","lastInvokeTime","leading","maxing","trailing","TypeError","invokeFunc","time","args","thisArg","apply","leadingEdge","setTimeout","timerExpired","shouldInvoke","timeSinceLastCall","trailingEdge","timeWaiting","remainingWait","debounced","isInvoking","arguments","clearTimeout","toNumber","cancel","flush","subscriptions","view","outlineProviderRegistry","ProviderRegistry","busySignalProvider","longLineLength","largeFileLineCount","lineCountIfLarge","largeFileMode","lineCount","getLineCount","buffer","getBuffer","i","len","lineLengthForRow","onDidCompositeDisposable","toggleOutlineView","outlinePane","destroyItem","rightDock","getRightDock","pane","getPanes","addItem","activateItem","show","async","getOutline","getActiveTextEditor","setStatus","getProviderForEditor","busySignalID","getFileName","outline","setOutline","outlineTrees","Boolean","id","presentStatus","CompositeDisposable","commands","activeTextEditorObserver","observeActiveTextEditor","dispose","updateDebounceTime","debouncedSelectAtCursorLine","debounce","onDidChangeCursorPosition","cursorPositionChangedEvent","doubouncedGetOutline","onDidStopChanging","onDidDestroy","addObservers","addProvider","registry","create","destroy"],"mappings":"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"}